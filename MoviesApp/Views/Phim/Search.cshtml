@model SearchResultViewModel
@{
    ViewData["Title"] = $"Kết quả tìm kiếm: {Model.Query}";
}

@section Styles {
    <link rel="stylesheet" href="~/css/search.css" />
}

<div class="search-container">
    <div class="container-fluid">
        <!-- Search Header -->
        <div class="search-header">
            <div class="search-form-container">
                <form class="search-form" method="get" asp-action="Search" asp-controller="Phim">
                    <div class="search-input-group">
                        <input type="text" name="q" value="@Model.Query" placeholder="Tìm kiếm phim, diễn viên, đạo diễn..." class="search-input" />
                        <button type="submit" class="search-btn">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </form>
            </div>
            
            @if (!string.IsNullOrEmpty(Model.Query))
            {
                <div class="search-info">
                    <h2>Kết quả tìm kiếm cho "<span class="search-query">@Model.Query</span>"</h2>
                    <p>Tìm thấy <strong>@Model.TotalResults</strong> kết quả</p>
                </div>
            }
        </div>
        
        <!-- Filters -->
        <div class="search-filters">
            <div class="filter-group">
                <label>Thể loại:</label>
                <select class="filter-select" name="genre" onchange="applyFilters()">
                    <option value="">Tất cả thể loại</option>
                    @foreach (var genre in Model.AvailableGenres)
                    {
                        <option value="@genre.MaTL" selected="@(Model.SelectedGenre == genre.MaTL)">@genre.TenTL</option>
                    }
                </select>
            </div>
            
            <div class="filter-group">
                <label>Quốc gia:</label>
                <select class="filter-select" name="country" onchange="applyFilters()">
                    <option value="">Tất cả quốc gia</option>
                    @foreach (var country in Model.AvailableCountries)
                    {
                        <option value="@country.MaQG" selected="@(Model.SelectedCountry == country.MaQG)">@country.TenQG</option>
                    }
                </select>
            </div>
            
            <div class="filter-group">
                <label>Năm:</label>
                <select class="filter-select" name="year" onchange="applyFilters()">
                    <option value="">Tất cả năm</option>
                    @for (int year = DateTime.Now.Year; year >= 1990; year--)
                    {
                        <option value="@year" selected="@(Model.SelectedYear == year)">@year</option>
                    }
                </select>
            </div>
            
            <div class="filter-group">
                <label>Sắp xếp:</label>
                <select class="filter-select" name="sort" onchange="applyFilters()">
                    <option value="relevance" selected="@(Model.SortBy == "relevance")">Liên quan nhất</option>
                    <option value="newest" selected="@(Model.SortBy == "newest")">Mới nhất</option>
                    <option value="oldest" selected="@(Model.SortBy == "oldest")">Cũ nhất</option>
                    <option value="rating" selected="@(Model.SortBy == "rating")">Đánh giá cao</option>
                    <option value="views" selected="@(Model.SortBy == "views")">Xem nhiều nhất</option>
                    <option value="name" selected="@(Model.SortBy == "name")">Tên A-Z</option>
                </select>
            </div>
            
            <button type="button" class="filter-clear" onclick="clearFilters()">
                <i class="fas fa-times me-1"></i>Xóa bộ lọc
            </button>
        </div>
        
        <!-- Search Results -->
        <div class="search-results">
            @if (Model.Movies?.Any() == true)
            {
                <div class="movies-grid" data-view="grid">
                    @foreach (var movie in Model.Movies)
                    {
                        <div class="movie-card" data-aos="fade-up">
                            <div class="movie-poster">
                                <img src="@movie.AnhDaiDien" alt="@movie.TenPhim" loading="lazy" />
                                <div class="movie-overlay">
                                    <div class="movie-actions">
                                        <a asp-controller="Phim" asp-action="Details" asp-route-id="@movie.MaPhim" class="btn-action btn-details">
                                            <i class="fas fa-info-circle"></i>
                                        </a>
                                        <a asp-controller="Phim" asp-action="Watch" asp-route-id="@movie.MaPhim" class="btn-action btn-play">
                                            <i class="fas fa-play"></i>
                                        </a>
                                        <button class="btn-action btn-wishlist" onclick="toggleWishlist(@movie.MaPhim, this)" data-movie-id="@movie.MaPhim">
                                            <i class="fas fa-heart"></i>
                                        </button>
                                    </div>
                                    <div class="movie-info-overlay">
                                        <h5>@movie.TenPhim</h5>
                                        <div class="movie-meta">
                                            <span class="year">@movie.NamSanXuat</span>
                                            <span class="rating">
                                                <i class="fas fa-star"></i>
                                                @(movie.DiemDanhGia?.ToString("0.1") ?? "N/A")
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="movie-details">
                                <h5 class="movie-title">@movie.TenPhim</h5>
                                <div class="movie-meta">
                                    <span class="genre">@movie.TheLoaiPhim?.TenTL</span>
                                    <span class="year">@movie.NamSanXuat</span>
                                </div>
                                <p class="movie-description">@Html.Raw(movie.MoTa?.Length > 100 ? movie.MoTa.Substring(0, 100) + "..." : movie.MoTa)</p>
                            </div>
                        </div>
                    }
                </div>
                
                <!-- Pagination -->
                @if (Model.TotalPages > 1)
                {
                    <div class="pagination-container">
                        <nav aria-label="Pagination">
                            <ul class="pagination">
                                @if (Model.CurrentPage > 1)
                                {
                                    <li class="page-item">
                                        <a class="page-link" href="@Url.Action("Search", new { q = Model.Query, page = Model.CurrentPage - 1, genre = Model.SelectedGenre, country = Model.SelectedCountry, year = Model.SelectedYear, sort = Model.SortBy })">
                                            <i class="fas fa-chevron-left"></i>
                                        </a>
                                    </li>
                                }
                                
                                @for (int i = Math.Max(1, Model.CurrentPage - 2); i <= Math.Min(Model.TotalPages, Model.CurrentPage + 2); i++)
                                {
                                    <li class="page-item @(i == Model.CurrentPage ? "active" : "")">
                                        <a class="page-link" href="@Url.Action("Search", new { q = Model.Query, page = i, genre = Model.SelectedGenre, country = Model.SelectedCountry, year = Model.SelectedYear, sort = Model.SortBy })">@i</a>
                                    </li>
                                }
                                
                                @if (Model.CurrentPage < Model.TotalPages)
                                {
                                    <li class="page-item">
                                        <a class="page-link" href="@Url.Action("Search", new { q = Model.Query, page = Model.CurrentPage + 1, genre = Model.SelectedGenre, country = Model.SelectedCountry, year = Model.SelectedYear, sort = Model.SortBy })">
                                            <i class="fas fa-chevron-right"></i>
                                        </a>
                                    </li>
                                }
                            </ul>
                        </nav>
                    </div>
                }
            }
            else
            {
                <div class="no-results">
                    <div class="no-results-icon">
                        <i class="fas fa-search"></i>
                    </div>
                    <h3>Không tìm thấy kết quả</h3>
                    <p>Không có phim nào khớp với từ khóa "<strong>@Model.Query</strong>"</p>
                    <div class="search-suggestions">
                        <h4>Gợi ý tìm kiếm:</h4>
                        <ul>
                            <li>Kiểm tra chính tả từ khóa</li>
                            <li>Thử sử dụng từ khóa khác</li>
                            <li>Sử dụng từ khóa ngắn gọn hơn</li>
                            <li>Thử tìm theo thể loại hoặc diễn viên</li>
                        </ul>
                    </div>
                    <a asp-controller="Phim" asp-action="Index" class="btn btn-primary">
                        <i class="fas fa-arrow-left me-1"></i>Quay lại danh sách phim
                    </a>
                </div>
            }
        </div>
        
        <!-- Popular Searches -->
        @if (Model.PopularSearches?.Any() == true)
        {
            <div class="popular-searches">
                <h4>Tìm kiếm phổ biến</h4>
                <div class="search-tags">
                    @foreach (var search in Model.PopularSearches)
                    {
                        <a href="@Url.Action("Search", new { q = search })" class="search-tag">@search</a>
                    }
                </div>
            </div>
        }
    </div>
</div>

@section Scripts {
    <script src="~/js/search.js"></script>
    <script>
        // Initialize AOS for animations
        AOS.init({
            duration: 600,
            once: true
        });
    </script>
}
